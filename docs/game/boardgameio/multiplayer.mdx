# Multiplayer

## Client

A boardgame.io client is what you create using the `Client` call. You initialize it with your game object.

In a multiplayer setup, clients delegate the running of the game to a game master. Clients emit moves / events, but the game logic runs on the master.

To connect a client to a remote master, we use the multiplayer option and specify the location of the server:

```tsx
import { SocketIO } from 'boardgame.io/multiplayer'

const TicTacToeClient = Client({
  game: TicTacToeGame,
  board: TicTacToeBoard,
  multiplayer: SocketIO({ server: 'localhost:8000' }),
});
```

Then render the game client for a specific player by passing in the `playerID` prop:

```tsx
<TicTacToeClient playerID="0" />
```


## Master

The master subscribes to moves / events and computes the next game state before broadcasting it to other clients.

To create a remote master, we use the `Server` class provided by `boardgame.io/server` module and configure it with:
- The game object
- List of URL origins we want to allow to connect to the server

```ts title="src/server.ts"
import { Server, Origins } from 'boardgame.io/server';
import { TicTacToeGame } from './games/tic-tac-toe';

const server = Server({
  games: [TicTacToeGame],
  origins: [Origins.LOCALHOST],
});

server.run(8000);
```

Then we start the server by running:

```bash
ts-node src/server.ts
```


## Multiple Game Types

You can serve multiple types of games from the same server:

```ts
const app = Server({ games: [TicTacToeGame, Chess] });
```

Make sure that each game configuration has a name:

```ts
const TicTacToeGame = {
  name: 'tic-tac-toe',
  // ...
};
```


## Game Instances (Matches)

To have multiple matches of the same game, pass `matchID` to your client:

```tsx
<TicTacToeClient matchID="match-id"/>
```


## Secret State

In some games you might need to hide information from players or spectators.

*For example, you might not want to reveal the hands of opponents in card games*.

To do this, use the `playerView` setting in the game object. It accepts a function that receives an object containing `G`, `ctx`, and `playerID` (for current player), and returns a stripped version of `G` that doesn't contain any information that should be hidden from that player.

```ts
const TicTacToeGame = {
  // `playerID` could also be null or undefined for spectators.
  playerView: ({ G, ctx, playerID }) => {
    return StripSecrets(G, playerID);
  },
  // ...
};
```

### Framework Default Behavior

The framework provide a `PlayerView.STRIP_SECRETS` function that does the following:
- It removes a key named `secret` from `G`
- If `G` contains a players object, it removes all keys except for the one that matches `playerID`

```ts
import { PlayerView } from 'boardgame.io/core';

const TicTacToeGame = {
  // ...
  playerView: PlayerView.STRIP_SECRETS,
};
```

For example, given the following `G`:
```js
G: {
  secret: { ... },

  players: {
    '0': { ... },
    '1': { ... },
    '2': { ... },
  }
}
```

It becomes the following for player `1`:

```js
G: {
  players: {
    '1': { ... },
  }
}
```

### Disabling moves on the client

Moves that manipulate secret state often cannot run on the client because the client doesn't have all the necessary data to process such moves. 

These can be marked as server-only by setting `client: false` on move:

```ts
moves: {
  moveThatUsesSecret: {
    move: ({ G, random }) => {
      G.secret.value = random.Number();
    },

    client: false,
  }
}
```
