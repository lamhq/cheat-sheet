# Writing tests

## Overview

A Playwright test includes steps to:
- perform actions on a web page
- assert the state against expectations

There is no need to wait to performing an action.

Tests are isolated. Each test runs in a clean, independent environment.

> [!INFO]
> By receiving a [page fixture](https://playwright.dev/docs/test-fixtures#built-in-fixtures), pages are isolated between tests due to the [Browser Context](https://playwright.dev/docs/browser-contexts), which is equivalent to a brand new browser profile.

```ts
import { test, expect } from '@playwright/test';

test.describe('SauceDemo login flow', () => {
  test('should login successfully and show products page', async ({ page }) => {
    // Step 1: Navigate to the site
    await page.goto('https://www.saucedemo.com/');

    // Step 2: Fill in login form
    await page.fill('#user-name', 'standard_user');
    await page.fill('#password', 'secret_sauce');

    // Step 3: Submit the form
    await page.click('#login-button');

    // Step 4: Assert that we are on the products page
    await expect(page).toHaveURL(/inventory.html/);

    // Step 5: Assert that a product is visible
    const firstProduct = page.locator('.inventory_item_name').first();
    await expect(firstProduct).toHaveText('Sauce Labs Backpack');
  });

  test('should show error with invalid credentials', async ({ page }) => {
    await page.goto('https://www.saucedemo.com/');

    await page.fill('#user-name', 'wrong_user');
    await page.fill('#password', 'wrong_password');
    await page.click('#login-button');

    // Assert error message
    const errorMessage = page.locator('[data-test="error"]');
    await expect(errorMessage).toContainText('Username and password do not match');
  });
});
```


## Locators

[Locators](https://playwright.dev/docs/locators) represent a way to find element(s) on the page.

- `getByRole()` â€“ locate elements by ARIA role and accessible name  
- `getByText()` â€“ match visible text content  
- `getByLabel()` â€“ target form controls by label text  
- `getByPlaceholder()` â€“ locate inputs by placeholder text  
- `getByAltText()` â€“ find images by alt attribute  
- `getByTitle()` â€“ match elements by title attribute  
- `getByTestId()` â€“ use custom `data-testid` attributes  
- `locator()` â€“ use CSS or XPath selectors directly
- `frameLocator()` - access `iframe` HTML tag to perform interactions inside the frame

```ts
await page.getByLabel('Password').fill('secret-password');

await page.getByRole('button', { name: 'Sign in' }).click();
```


## Actions

Check [here](https://playwright.dev/docs/input) for all available actions.

### Page actions

- `page.goto(url)` â€“ navigate to a specific URL  
- `page.screenshot()` â€“ take a screenshot of the page  
- `page.pdf()` â€“ generate a PDF (Chromium only)  
- `page.evaluate(fn)` â€“ run custom JavaScript in the page context  
- `page.addInitScript()` â€“ inject scripts before any page loads  
- `page.context().storageState()` â€“ capture cookies and localStorage  

```ts
await page.goto('https://playwright.dev/');
```

### Locator actions

- `locator.click()` â€“ click on an element  
- `locator.fill()` â€“ enter text into input fields  
- `locator.type()` â€“ simulate typing character-by-character  
- `locator.press()` â€“ press keyboard keys (e.g. Enter, Tab)  
- `locator.check()` / `locator.uncheck()` â€“ toggle checkboxes  
- `locator.selectOption()` â€“ choose from dropdown menus  
- `locator.hover()` â€“ simulate mouse hover over an element  
- `locator.setInputFiles()` â€“ upload files to input fields  
- `locator.focus()` â€“ set focus on an element  
- `locator.clear()` â€“ clear input field content  
- `locator.scrollIntoViewIfNeeded()` â€“ scroll element into view  
- `locator.screenshot()` â€“ capture screenshot of the element  
- `locator.evaluate()` â€“ run custom JavaScript on the element  
- `locator.isVisible()` â€“ check if the element is visible  
- `locator.count()` â€“ count number of matching elements

```ts
await page.getByLabel('Password').fill('secret-password');
```


## Assertions

Check [here](https://playwright.dev/docs/test-assertions) for a list of available assertions.

### Element State Assertions

- `toBeVisible()` â€“ element is visible  
- `toBeHidden()` â€“ element is hidden or not in DOM  
- `toBeEnabled()` â€“ element is enabled  
- `toBeDisabled()` â€“ element is disabled  
- `toBeChecked()` â€“ checkbox or radio is checked  
- `toBeEditable()` â€“ input is editable  
- `toBeEmpty()` â€“ element has no text content  
- `toBeFocused()` â€“ element is focused 
- `toHaveTitle()` â€“ page has expected title  

```ts
await expect(page.getByText('Welcome, John!')).toBeVisible();
```

### Content & Attribute Assertions

- `toHaveText()` â€“ element has exact text  
- `toContainText()` â€“ element contains partial text  
- `toHaveAttribute()` â€“ element has specific attribute  
- `toHaveClass()` â€“ element has specific class  
- `toHaveValue()` â€“ input has a specific value  
- `toHaveCount()` â€“ locator matches expected number of elements  
- `toHaveCSS()` â€“ element has specific CSS property  

```ts
await expect(page.getByTitle('Issues count')).toHaveText('25 issues');
```

### Page-Level Assertions

- `toHaveURL()` â€“ page has expected URL  
- `toHaveScreenshot()` â€“ page matches screenshot  

```ts
await expect(page).toHaveURL(/inventory.html/);
```

### Response Assertions

- `toBeOK()` â€“ response status is OK (200â€“299)  
- `toBe(statusCode)` â€“ response has specific status code

```ts
import { test, expect } from '@playwright/test';

test('API returns OK response', async ({ request }) => {
  const response = await request.get('https://jsonplaceholder.typicode.com/posts/1');
  await expect(response).toBeOK(); // âœ… passes if status is 200â€“299
});
```


## Structuring tests

- `describe`: declare a group of tests
- `step`: declares a test step that is shown in the report

```ts
import { test, expect } from '@playwright/test';

test.describe('Login flow', () => {
  test('valid user can log in', async ({ page }) => {
    await test.step('Navigate to login page', async () => {
      await page.goto('https://www.saucedemo.com/');
    });

    await test.step('Fill credentials and submit', async () => {
      await page.fill('#user-name', 'standard_user');
      await page.fill('#password', 'secret_sauce');
      await page.click('#login-button');
    });

    await test.step('Verify dashboard', async () => {
      await expect(page).toHaveURL(/inventory.html/);
      await expect(page.locator('.inventory_item_name').first())
        .toHaveText('Sauce Labs Backpack');
    });
  });
});
```


## Test Hooks

- `beforeAll`, `afterAll`: executed once, before/after all tests in its scope (root or nested describe)
- `beforeEach`, `afterEach`: executed before/after each test

```ts
import { test, expect } from '@playwright/test';

// Global hooks: run once for ALL tests in this file
test.beforeAll(() => console.log('ðŸŒ Global beforeAll'));
test.afterAll(() => console.log('ðŸŒ Global afterAll'));

test('Outside test #1', async ({ page }) => {
  console.log('âž¡ï¸ Outside test #1');
  await page.goto('https://example.com');
  await expect(page).toHaveTitle(/Example/);
});

test.describe('Inside describe block', () => {
  // Local hooks: run once for tests in THIS block only
  test.beforeAll(() => console.log('ðŸ“¦ Local beforeAll'));
  test.afterAll(() => console.log('ðŸ“¦ Local afterAll'));

  test('Inside test #1', async ({ page }) => {
    console.log('âž¡ï¸ Inside test #1');
    await page.goto('https://example.com');
    await expect(page.locator('h1')).toHaveText('Example Domain');
  });

  test('Inside test #2', async ({ page }) => {
    console.log('âž¡ï¸ Inside test #2');
    await page.goto('https://example.com');
    await expect(page).toHaveTitle(/Example/);
  });
});
```

## Annotations

- `test.skip()`: Marks test as irrelevant; Playwright skips it. Use when not applicable in some configurations.
- `test.fail()`: Marks test as expected to fail; runs and verifies failure. Complains if it passes.
- `test.fixme()`: Marks test as failing; skips execution. Use when running is slow or crashes.
- `test.slow()`: Marks test as slow; triples the timeout.
- `test.only()`: Runs only this test; skips all others. Useful for focused debugging.

Conditionally skip a test (or a group of tests):

```ts
test('skip this test', async ({ page, browserName }) => {
  test.skip(browserName === 'firefox', 'Still working on it');
});
```
