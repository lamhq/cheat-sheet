# Deployment

## Requirements

1. Each Microfrontend can be deployed independently (include the shell app)
2. Each Microfrontend need its own CI/CD pipeline configuration (e.g., GitHub Actions)
3. The shell app need to know the location of the `remoteEntry.js` file of each Microfrontend at build time


## Solution

### Microfrontends

Each Microfrontend is packaged as a single JavaScript file and deployed to a web server (or CDN), the location of the `remoteEntry.js` file follows the format:

```
https://{domain}/{app-name}/{version}/remoteEntry.js
```
- `{domain}`: The domain of the web server.
- `{app-name}`: Identifier for the microfrontend (e.g., "marketing").
- `{version}`: the version of the microfrontend, allowing the shell app to load different versions as needed.

All `remoteEntry.js` files are hosted at the same domain to simplify deployment.

To avoid caching issues on production, the cache need to be cleared after deploy (for example, by issuing a CloudFront invalidation request).


### Shell app

The domain is stored as an environment variable on the shell app's CI server and referenced in its Webpack configuration to resolve the location of each microfrontend's `remoteEntry.js` file:

```js title="shell/webpack.prod.js"
const domain = process.env.PRODUCTION_DOMAIN;

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'shell',
      remotes: {
        marketing: `marketing@https://${domain}/marketing/latest/remoteEntry.js`,
        auth: `auth@https://${domain}/auth/latest/remoteEntry.js`,
      },
    }),
  ],
};
```