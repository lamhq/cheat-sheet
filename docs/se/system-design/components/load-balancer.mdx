# Load Balancers

## Overview

A load balancer balances the traffic load among a group of servers, to make sure no individual server is overloaded.

A load balancer communicates with servers through private IPs. Servers are unreachable directly by clients anymore.

> [!INFO]
> A private IP is an IP address reachable only between servers in the same network; however, it is unreachable over the internet.

![](./load-balancer/load-balancer.drawio.svg)

Load balancers are usually collocated with the group of servers they manage, to minimize latency.


## Benefits

A load balancer provides Quality Attributes:
- **Scalability**. Servers can be added when traffic spikes and removed when demand drops, saving costs.
- **Availability**. Load balancers monitor servers and stop sending traffic to those that are down or slow.
- **Performance** (throughput). With multiple servers handling requests, the system can process more tasks per second than a single server could.
- **Maintainability**. Servers can be taken offline one at a time for maintenance or upgrades.


## Routing Strategies

Load balancers use various strategies to distribute network traffic across multiple servers:
1. **Round Robin**: Distributes requests sequentially across all servers.
2. **Least Connections**: Directs traffic to the server with the fewest active connections.
3. **Least Response Time**: Sends requests to the server with the quickest response time.
4. **IP Hash**: Uses the client's IP address to determine which server receives the request.
5. **Weighted Algorithms**: Assigns more traffic to servers with higher capacities.
6. **Geographical Algorithms**: Routes traffic based on the geographical location of the client.


## Load Balancer Types

### Layer 4 (hardware)

- Operates at the transport layer of the OSI model
- Routing based on: IP addresses, ports, protocol (TCP / UDP) of the request
- Suitable for applications where high performance and low latency are critical, such as in real-time applications and high-throughput environments

### Layer 7 (software)

- Operates at the application layer of the OSI model
- Has access to everything layer 4 has
- Can route based on HTTP headers, cookies, payload of the request
- More complex than Layer 4 load balancers
- Ideal for web applications where detailed inspection and intelligent routing of traffic are required.


### Global Server Load Balancer

A **GSLB** is an advanced type of load balancing solution that combines:
- **DNS functionality** (resolving domain names to IP addresses)
- **Load balancing intelligence** (like monitoring server health and traffic)

How it works:
1. GSLB uses the user's IP address to estimate their geographic location.
2. It tracks the health and performance of all registered servers across different data centers.
3. When a user sends a DNS query, the GSLB responds with the IP of the best server.

GSLBs can route users based on:
- Physical location
- Server load (traffic, CPU load)
- Response time
- Bandwidth between user and data center

GSLBs play a very important role in disaster recovery, if a data center goes down, GSLB redirects users to healthy locations.

To prevent a load balancer from being a single point of failure in each region, multiple load balancers can be registered with GSLB, so clients can get a list of load balancers to choose from.


## Sticky sessions

Sticky sessions (session affinity) are a method used in load balancing to ensure requests from a particular client to be consistently routed to the same server.

Pros:
- Easy to integrate with stateful servers, no code changes required.
- Improved User Experience: Ensures that a user's session data is consistently handled by the same server, reducing the need for session data to be shared or synchronized between servers.

Cons:
- Adds overhead to the load balancer to track and maintain session affinity
- Hard to scale horizontally. Adding or removing servers is much more difficult
- Challenging to handle server failures
- It can lead to uneven load distribution. If one server receives a disproportionate number of sessions, it can become a bottleneck, while other servers remain underutilized


## Load Balancing Solutions

Open Source Software Load Balancing Solutions:
- **HAProxy**: TCP/HTTP load balancer. Suited for very high traffic web sites. Shipped with most mainstream Linux distributions.
- **NGINX**: HTTP server and reverse proxy (load balancer). Known for its high performance, stability, rich feature set and simple configuration.


Cloud Based Load Balancing Solutions:
- **AWS - Elastic Load Balancing (ELB)**: Highly scalable load balancing solution. Ideal for running on AWS, and integrates seamlessly with all of AWS services.
- **GCP - Cloud Load Balancing**: Google's highly scalable and robust load-balancing solution.
- **Microsoft Azure Load Balancer**: Microsoft Azure load balancing solution.

GSLB Solutions:
- **Amazon Route 53**: Amazon Route 53 is a highly available and scalable cloud Domain Name System (DNS) web service.
- **AWS Global Accelerator**: A networking service that helps you improve the availability, performance, and security of your public applications.
- **Google Cloud Platform Load Balancer & Cloud DNS**: Reliable, resilient, low-latency DNS serving from Google's worldwide network with everything you need to register, manage, and serve your domains.
- **Azure Traffic Manager**: DNS-based load balancing