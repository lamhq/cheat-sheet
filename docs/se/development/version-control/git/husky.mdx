import { PackageManagerTabs } from '@theme'

# Husky

## Version

This document is for version 9.


## About

Husky is a tool that makes it easy to set up and manage Git hooks.

Git hooks are scripts that run automatically on certain Git events, like committing or pushing code.

Husky ensure tasks like code formatting, linting, or tests are run automatically before commits or pushes.


## Install

```sh
npx husky init
```


## Add Hook

To add a hook:
```sh
echo "npm test" > .husky/pre-commit
```


## Recipes

### Lint staged files

Install `lint-staged`:

<PackageManagerTabs command="install --save-dev lint-staged" />

Add `lint-staged` configuration to `package.json`:

```json
{
  "lint-staged": {
    "*.ts?(x)": "eslint --fix"
  }
}
```

Run `lint-staged` command before commit (via pre-commit hook):

```sh
echo "npx lint-staged" > .husky/pre-commit
```


### Lint commit message

Install commitlint:

<PackageManagerTabs command="install -D @commitlint/cli @commitlint/config-conventional" />

Add commitlint configuration:

```js title="commitlint.config.mjs"
export default {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'docs',
        'style',
        'refactor',
        'perf',
        'test',
        'build',
        'ci',
        'chore',
        'revert',
      ],
    ],
    'type-case': [2, 'always', 'lowerCase'],
    'type-empty': [2, 'never'],
    'subject-empty': [2, 'never'],
    'subject-full-stop': [2, 'never', '.'],
    'header-max-length': [2, 'always', 72],
  },
};
```

Create a commit-msg hook file to run `commitlint`:

```sh title=".husky/commit-msg"
npx --no -- commitlint --edit "$1" 
```


### Check branch name before commit

<PackageManagerTabs command="install -D git-branch-is@^4.0.0 " />

Add branch name check before push (via pre-push hook):

```sh
echo "npx git-branch-is -r '^(feature|fix)/[a-z\\-\\d\\.]+$'" > .husky/pre-push
```


### Run unit test before push

Add a test script to `package.json`:

```sh
npm pkg set scripts.test:cov="jest --coverage"
```

Run test command before commit (via pre-commit hook):

```sh
echo "npm run test:cov" > .husky/pre-commit
```
