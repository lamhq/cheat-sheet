import { PackageManagerTabs } from '@theme';

# Tasks

## Overview

A task is a script that Turborepo runs. You can express relationships between tasks in your [`turbo.json`](https://turborepo.com/docs/reference/configuration) configuration and [Package Graph](https://turborepo.com/docs/core-concepts/package-and-task-graph#package-graph).

Turborepo will always parallelize any work that it can to ensure everything runs as fast as possible.


## Defining tasks

For tasks that you run frequently, you can write your `turbo` commands directly into your root `package.json`.

```jsonc title="./package.json"
{
  "scripts": {
    "dev": "turbo run dev",
    "build": "turbo run build",
    "test": "turbo run test",
    "lint": "turbo run lint"
  }
}
```

These scripts can then be run using your package manager:

<PackageManagerTabs command="dev" />


You only want to write `turbo` commands in your root `package.json`. Writing `turbo` commands into the `package.json` of packages can lead to recursively calling `turbo`.

> [!INFO]
> `turbo` is an alias for `turbo run`.


## Defining task order

### Run tasks in direct dependencies first

```json title="turbo.json"
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"] 
    }
  }
}
```

- The `^` means run the task in direct dependencies first. _If your application depends on a library named `ui` and the library has a `build` task, the `build` script in `ui` will run first._


### Depending on tasks in the same package

```json title="turbo.json"
{
  "tasks": {
    "test": {
      "dependsOn": ["build"] 
    }
  }
}
```


### Depending on a specific task in a specific package

```json title="turbo.json"
{
  "tasks": {
    "lint": {
      "dependsOn": ["utils#build"] 
    }
  }
}
```

```json title="turbo.json"
{
  "tasks": {
    "web#lint": {
      "dependsOn": ["utils#build"] 
    }
  }
}
```


### Long-running (dev) tasks

You might have a long-running task that requires another task to always be running at the same time.

For example, a web app might require an API server to be running while it's in development mode:

```json title="apps/web/turbo.json"
{
  "tasks": {
    "dev": {
      "with": ["api#dev"],
      "persistent": true,
      "cache": false
    }
  }
}
```


### Specifying output

The `outputs` key tells Turborepo files and directories it should cache when the task has successfully completed.

```json title="turbo.json"
{
  "tasks": {
    "build": {
      "outputs": [".next/**", "!.next/cache/**"] 
    }
  }
}
```


### Specifying inputs

The `inputs` key is used to specify the files that you want to include in the task's hash for caching. 

By default all files in the package that are checked into source control are included in the hash.

In this example, Turborepo will use the default inputs behavior for the build task, but will ignore changes to the `README.md` file:

```json title="turbo.json"
{
  "tasks": {
    "spell-check": {
      "inputs": ["$TURBO_DEFAULT$", "!README.md"] 
    }
  }
}
```

You can add environment variables to task hashes:

```json title="turbo.json"
{
  "globalEnv": ["IMPORTANT_GLOBAL_VARIABLE"],
  "tasks": {
    "build": {
      "env": ["MY_API_URL", "MY_API_KEY"]
    }
  }
}
```
- **globalEnv**: Changes to the values of any environment variables in this list will change the hash for all tasks.
- **env**: Includes changes to the values of environment variables that affect the task, allowing for better granularity. For example, a `lint` task probably doesn't need to miss cache when the value of `API_KEY` changes, but a `build` task likely should.


## Running Tasks

1. You can use package manager to run tasks defined in the root `package.json`.
2. Additionally, installing `turbo` globally lets you run one-off commands directly from your terminal.
3. You can run tasks in watch mode with `turbo watch [task]`. Tasks are re-run whenever you make changes to its dependencies.

Running multiple tasks:

```bash title="Terminal"
turbo run build test lint check-types
```

Filtering by package:

```bash title="Terminal"
turbo build --filter=@acme/web
```

Filtering by directory:

```bash title="Terminal"
turbo lint --filter="./packages/utilities/*"
```

Run task in a package and all packages that **depend on it**:

```bash title="Terminal"
turbo build --filter=...ui
```

Run task in a package and all of **its dependencies**:

```bash title="Terminal"
turbo dev --filter=web...
```

Combining filters:

```bash title="Terminal"
turbo build --filter=...ui --filter={./packages/*} --filter=[HEAD^1]
```

Run tasks in watch mode:

```bash title="Terminal"
turbo watch dev lint
```

When running `turbo` in a package's directory, it will automatically scope commands to that package:

```bash title="Terminal"
cd apps/docs
turbo build
```
