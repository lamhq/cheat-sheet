# Metrics

## Overview

When you interact with AWS Glue, it sends metrics to CloudWatch. 

You can view these metrics using:
- AWS Glue console (the preferred method)
- CloudWatch console dashboard
- AWS Command Line Interface (AWS CLI)


## Key metrics

Some of the key metrics include:
- **Driver Memory Usage**: Indicates how much memory the driver process is using.
- **Executor Memory Usage**: Shows memory usage by executor processes.
- **Task Execution Time**: Measures the time taken by individual tasks.
- **Shuffle Read/Write Metrics**: Tracks data shuffling between stages.
- **Input/Output Metrics**: Provides information about data read and written.
- **Garbage Collection Metrics**: Monitors JVM garbage collection.
- **Job Execution Status**: Indicates whether the job succeeded, failed, or was canceled.

AWS Glue send metrics sent to Cloudwatch every 30 seconds.

View the list of metrics [here](https://docs.aws.amazon.com/glue/latest/dg/monitoring-awsglue-with-cloudwatch-metrics.html#awsglue-metrics).


## AWS Glue console

You can view summary or detailed graphs of metrics for a job, or detailed graphs for a job run.

- Open the [AWS Glue console](https://console.aws.amazon.com/glue/)
- In the navigation pane, choose **Job run monitoring**.
- Select a job, then choose **View run details**


## CloudWatch console

Metrics are grouped first by the service namespace, and then by the various dimension combinations within each namespace (e.g. `JobName`, `JobRunId`, `Type`).

- Open the [CloudWatch console](https://console.aws.amazon.com/cloudwatch/)
- In the navigation pane, choose **Metrics**
- Choose the **Glue** namespace.


## AWS CLI

To view metrics using the AWS CLI:
```sh
aws cloudwatch list-metrics --namespace Glue
```


## Cloudwatch alarms

You can set up alarms on any AWS Glue metric for scheduled jobs.

Common scenarios for setting up alarms:
- Jobs running out of memory.
- Straggling executors: Set an alarm when the number of executors falls below a certain threshold for a large duration of time in a job.
- Data backlog or reprocessing: Compare the metrics from individual jobs in a workflow using a CloudWatch math expression. You can then trigger an alarm on the resulting expression value.


## CloudWatch Events

Some examples of using CloudWatch Events with AWS Glue include the following:

- Activating a Lambda function when an ETL job succeeds
- Notifying an Amazon SNS topic when an ETL job fails

View the list of [CloudWatch Events generated by AWS Glue](https://docs.aws.amazon.com/glue/latest/dg/automating-awsglue-with-cloudwatch-events.html).


## Resource monitoring

AWS Glue allows you to view the service's resource usage as a percentage in Amazon CloudWatch and to configure CloudWatch alarms on it to monitor usage. 

*For example, if you have 10 workflows created, and your service quota allows you to have 200 workflows in maximum, then your usage is 10/200 = 5%, and in graph, you will see a datapoint of 5 as a percentage.*

The following metrics are supported:
- Number of workflows per account
- Number of triggers per account
- Number of jobs per account
- Number of concurrent job runs per account
- Number of blueprints per account
- Number of interactive sessions per account

To use this feature, you can go to the Amazon CloudWatch console to view the metrics and configure alarms.

*For example, once the workflow resource usage reaches 80%, it triggers an alarm to send a message to the existing SNS topic, where you can subscribe to it to get notifications.*

```json
{
	"Type": "AWS::CloudWatch::Alarm",
	"Properties": {
		"AlarmName": "WorkflowUsageAlarm",
		"ActionsEnabled": true,
		"OKActions": [],
		"AlarmActions": [
			"arn:aws:sns:af-south-1:085425700061:Default_CloudWatch_Alarms_Topic"
		],
		"InsufficientDataActions": [],
		"MetricName": "ResourceUsage",
		"Namespace": "AWS/Glue",
		"Statistic": "Maximum",
		"Dimensions": [{
				"Name": "Type",
				"Value": "Resource"
			},
			{
				"Name": "Resource",
				"Value": "Workflow"
			},
			{
				"Name": "Service",
				"Value": "Glue"
			},
			{
				"Name": "Class",
				"Value": "None"
			}
		],
		"Period": 3600,
		"EvaluationPeriods": 1,
		"DatapointsToAlarm": 1,
		"Threshold": 80,
		"ComparisonOperator": "GreaterThanThreshold",
		"TreatMissingData": "notBreaching"
	}
}
```
